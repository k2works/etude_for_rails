version: '2'
services:
  base:
    build: .
    image: app:base
  app:
    build:
      context: .
      dockerfile: Dockerfile-dev
    environment:
      RAILS_ENV: development
      DATABASE_URL: mysql2://root:pass@mysql:3306
    ports:
     - "5000:5000"
     - "9292:9292"
    volumes:
     - .:/usr/src/app
    links:
      - mysql
  livereload:
    build:
      # same build settings as your Rails app
      context: .
      dockerfile: Dockerfile-dev
    command: bundle exec guard -P livereload
    # [...] whatever else you need
    ports:
      - 35729:35729
    volumes:
      - .:/usr/src/app  # or however you configured your Rails root volume
  mysql:
    image: mysql:5.7.10
    environment:
      MYSQL_ROOT_PASSWORD: 'pass'
    ports:
      - '3306:3306'
    volumes:
      - mysql-data:/var/lib/mysql
volumes:
  mysql-data:
    driver: local
